<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JBレンタカー - くわしく見積もり</title>
  <style>
    /* 全体の設定 */
    body {
      font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'メイリオ', sans-serif;
      background-color: #f9f9f9;
      color: #333;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .header {
      text-align: center;
      margin-bottom: 20px;
      width: 100%;
      max-width: 500px;
    }
    .logo {
      font-size: 32px;
      font-weight: bold;
      color: #0068e9;
      margin-bottom: 5px;
    }
    h1 {
      background-color: #0068e9;
      color: #fff;
      font-size: 24px;
      text-align: center;
      padding: 12px 20px;
      border-radius: 8px;
      width: 100%;
      max-width: 500px;
      margin: 0 0 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .card {
      background-color: #fff;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
      max-width: 500px;
      width: 100%;
      margin-bottom: 20px;
      box-sizing: border-box;
      border: 1px solid #eaeaea;
      animation: fadeIn 0.5s ease-out forwards;
    }
    .section-title {
      font-size: 18px;
      color: #0068e9;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 2px solid #ffc600;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
      color: #333;
    }
    input[type="date"],
    input[type="number"],
    select {
      width: 100%;
      padding: 12px;
      margin-bottom: 8px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
      background-color: #f9f9f9;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    input[type="date"]:focus,
    input[type="number"]:focus,
    select:focus {
      outline: none;
      border-color: #0068e9;
      box-shadow: 0 0 0 3px rgba(0, 104, 233, 0.2);
    }
    button {
      width: 100%;
      padding: 14px;
      background-color: #0068e9;
      color: #fff;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      margin-top: 10px;
      box-shadow: 0 4px 8px rgba(0, 104, 233, 0.3);
    }
    button:hover {
      background-color: #0051b5;
      transform: translateY(-2px);
    }
    button:active {
      transform: translateY(0);
    }
    .inquiry-link {
      text-align: center;
      margin-top: 20px;
    }
    .button-link {
      display: inline-block;
      padding: 14px 20px;
      background-color: #ffc600;
      color: #333;
      text-decoration: none;
      font-size: 16px;
      font-weight: bold;
      border-radius: 8px;
      transition: background-color 0.3s, transform 0.2s;
      box-shadow: 0 4px 8px rgba(255, 198, 0, 0.3);
    }
    .button-link:hover {
      background-color: #ffb400;
      transform: translateY(-2px);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">JBレンタカー</div>
  </div>

  <h1>🚗 くわしく見積もり</h1>

  <!-- 入力フォーム -->
  <div class="card">
    <form id="rentalForm" onsubmit="event.preventDefault(); calculateAndShowResult();">
      <div class="section-title">基本情報</div>
      <div class="form-group">
        <label for="startDate">ご利用開始日 <span style="color: #0068e9;">*</span></label>
        <input type="date" id="startDate" required>
        <div id="startDateError" class="error-message" style="color: red; display: none;">利用開始日を選択してください</div>
      </div>
      <div class="form-group">
        <label for="days">ご利用日数 <span style="color: #0068e9;">*</span></label>
        <input type="number" id="days" min="1" max="365" value="7" step="1">
        <div id="daysError" class="error-message" style="color: red; display: none;">利用日数は1日以上で入力してください</div>
      </div>
      <div class="form-group">
        <label for="carClass">車両クラス <span style="color: #0068e9;">*</span></label>
        <select id="carClass" required onchange="updateCarImage()">
          <option value="">選択してください</option>
          <option value="J-1">J-1：軽自動車（2ドア）</option>
          <option value="J-2">J-2：軽自動車（4ドア）</option>
          <option value="J-3">J-3：軽貨物バン</option>
          <option value="J-4">J-4：小型乗用車</option>
        </select>
        <div id="carClassError" class="error-message" style="color: red; display: none;">車両クラスを選択してください</div>
      </div>
      <!-- ここに車両画像表示領域等があれば追加 -->
      <div class="section-title">オプション</div>
      <div class="form-group">
        <input type="checkbox" id="insurance">
        <label for="insurance">車両保険</label>
      </div>
      <div class="form-group">
        <input type="checkbox" id="waiver">
        <label for="waiver">免責補償</label>
      </div>
      <div class="form-group">
        <input type="checkbox" id="tires">
        <label for="tires">スタッドレスタイヤ</label>
      </div>
      <div class="form-group">
        <input type="checkbox" id="etc">
        <label for="etc">ETC</label>
      </div>
      <div class="form-group">
        <input type="checkbox" id="gps">
        <label for="gps">カーナビ</label>
      </div>
      <button type="submit">見積もりを計算する</button>
    </form>
  </div>

  <!-- お見積もり結果表示エリア -->
  <div id="result" class="card" style="display: none;">
    <div class="section-title">お見積もり結果</div>
    <div id="resultContent"></div>
    <div class="inquiry-link">
      <!-- 問い合わせリンクの href は JS で動的に上書き -->
      <a href="https://jb-rentacar.com/miyagi/#contact" target="_blank" class="button-link">空き状況を確認する ➡</a>
    </div>
  </div>

  <script>
    // 料金表や車両説明（例）
    const rateTable = {
      "J-1": [1980, 3960, 5940, /* ... */],
      "J-2": [2480, 4960, 7440, /* ... */],
      "J-3": [3180, 6360, 9540, /* ... */],
      "J-4": [3380, 6760, 10140, /* ... */]
      // ※詳細は実際の料金表に合わせてください
    };

    const carDescriptions = {
      "J-1": "軽自動車（2ドア） - コンパクトで使いやすい車両です。",
      "J-2": "軽自動車（4ドア） - 乗り降りがしやすく実用的です。",
      "J-3": "軽貨物バン - 荷物の多い方におすすめです。",
      "J-4": "小型乗用車 - 快適な乗り心地と十分な荷室スペースを持ちます。"
    };

    // 車両画像を更新する関数（必要に応じて画像パスなどを調整）
    function updateCarImage() {
      const carClass = document.getElementById("carClass").value;
      // ここで画像表示等の処理を追加
      // 例：document.getElementById("carImage").src = carClass.replace("-", "") + ".png";
    }

    // フォームバリデーション
    function validateForm() {
      let valid = true;
      const startDate = document.getElementById("startDate").value;
      if (!startDate) {
        document.getElementById("startDateError").style.display = "block";
        valid = false;
      }
      const days = parseInt(document.getElementById("days").value);
      if (isNaN(days) || days < 1) {
        document.getElementById("daysError").style.display = "block";
        valid = false;
      }
      const carClass = document.getElementById("carClass").value;
      if (!carClass) {
        document.getElementById("carClassError").style.display = "block";
        valid = false;
      }
      return valid;
    }

    // 見積もり計算と結果表示
    function calculateAndShowResult() {
      if (!validateForm()) { return; }
      
      // ステップ等があれば更新（省略）
      const startDate = document.getElementById("startDate").value;
      const days = parseInt(document.getElementById("days").value);
      const carClass = document.getElementById("carClass").value;
      const insurance = document.getElementById("insurance").checked;
      const waiver = document.getElementById("waiver").checked;
      const tires = document.getElementById("tires").checked;
      const etc = document.getElementById("etc").checked;
      const gps = document.getElementById("gps").checked;

      // ここでは簡単な例として基本料金だけ計算
      let totalBaseRate = 0;
      if (rateTable[carClass] && rateTable[carClass][Math.min(days - 1, rateTable[carClass].length - 1)]) {
        totalBaseRate = rateTable[carClass][Math.min(days - 1, rateTable[carClass].length - 1)];
      }
      
      // オプション料金（例）
      let optionCost = 0;
      let optionsList = [];
      if (insurance) { optionCost += 1000; optionsList.push("車両保険"); }
      if (waiver) { optionCost += 1000; optionsList.push("免責補償"); }
      if (tires)   { optionCost += 1000; optionsList.push("スタッドレスタイヤ"); }
      if (etc)     { optionCost += 500;  optionsList.push("ETC"); }
      if (gps)     { optionCost += 500;  optionsList.push("カーナビ"); }
      
      const subtotal = totalBaseRate + optionCost;
      const tax = Math.round(subtotal * 0.1);
      const total = subtotal + tax;
      
      // 日付のフォーマット
      const startDateObj = new Date(startDate);
      const returnDateObj = new Date(startDate);
      returnDateObj.setDate(startDateObj.getDate() + days);
      const formatDate = date => {
        const y = date.getFullYear();
        const m = (date.getMonth() + 1).toString().padStart(2, '0');
        const d = date.getDate().toString().padStart(2, '0');
        const w = ['日', '月', '火', '水', '木', '金', '土'][date.getDay()];
        return `${y}年${m}月${d}日(${w})`;
      };
      const formattedStartDate = formatDate(startDateObj);
      const formattedReturnDate = formatDate(returnDateObj);
      
      // 結果表示用HTML（例）
      const resultContent = document.getElementById("resultContent");
      resultContent.innerHTML = `
        <div>ご利用開始日: <strong>${formattedStartDate}</strong></div>
        <div>ご返却日: <strong>${formattedReturnDate}</strong></div>
        <div>ご利用日数: <strong>${days}日間</strong></div>
        <div>選択車両: <strong>${document.getElementById("carClass").options[document.getElementById("carClass").selectedIndex].text}</strong></div>
        <div>基本料金: <strong>¥${totalBaseRate.toLocaleString()}</strong></div>
        <div>オプション料金: <strong>¥${optionCost.toLocaleString()}</strong></div>
        <div>小計: <strong>¥${subtotal.toLocaleString()}</strong></div>
        <div>消費税 (10%): <strong>¥${tax.toLocaleString()}</strong></div>
        <div>合計金額: <strong>¥${total.toLocaleString()}</strong></div>
      `;
      
      // 問い合わせリンクのURLを入力内容から組み立てる
      const inquiryLink = document.querySelector(".inquiry-link a");
      // 送信側から渡すパラメータのキー名は受け手側フォームの name 属性と一致させる必要がある
      // 受け手側フォームでは「予定出発日（レンタル開始希望日）」, 「予定車種ランク」, 「その他」
      const selectedCarText = document.getElementById("carClass").options[document.getElementById("carClass").selectedIndex].text;
      const optionString = optionsList.length > 0 ? "オプション：" + optionsList.join("、") + "希望" : "";
      
      const params = new URLSearchParams({
        "予定出発日（レンタル開始希望日）": startDate,           // キー名を受け手側と合わせる
        "予定車種ランク": selectedCarText,                       // キー名は「予定車種ランク」
        "その他": optionString                                    // キー名は「その他」
      });
      
      // 組み立てたクエリパラメータを付与し、#contact でフォームへスクロールさせる
      const newUrl = "https://jb-rentacar.com/miyagi/?" + params.toString() + "#contact";
      inquiryLink.href = newUrl;
      
      // 結果エリアの表示とスクロール
      document.getElementById("result").style.display = "block";
      document.getElementById("result").scrollIntoView({ behavior: "smooth" });
    }

    // 初期設定：今日の日付を設定
    document.addEventListener("DOMContentLoaded", function() {
      const today = new Date();
      const formattedToday = today.toISOString().split("T")[0];
      document.getElementById("startDate").value = formattedToday;
      // エラーメッセージのクリア
      document.getElementById("startDate").addEventListener("input", function() {
        document.getElementById("startDateError").style.display = "none";
      });
      document.getElementById("days").addEventListener("input", function() {
        document.getElementById("daysError").style.display = "none";
      });
      document.getElementById("carClass").addEventListener("change", function() {
        document.getElementById("carClassError").style.display = "none";
      });
    });
  </script>
</body>
</html>
